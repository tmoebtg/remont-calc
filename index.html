<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Калькулятор бюджета ремонта</title>

<!-- Chart.js + плагин процентов -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

<style>
:root{
  --bg:#0f1216; --card:#161b22; --muted:#8892a6;
  --accent:#22c55e; --danger:#ef4444; --ring:#2a2f39;
  --text:#e5e7eb; --sub:#cbd5e1;
  --blue:#5EA0FF; --pink:#FF7A8B; --orange:#FFB04D;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial}
.wrapper{max-width:1120px;margin:32px auto;padding:0 16px}
.card{background:var(--card);border:1px solid var(--ring);border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.35);padding:22px}

h1{font-size:28px;margin:0 0 14px}
.row{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin:16px 0 6px}
.field{display:grid;gap:6px}
.field label{font-size:12px;color:var(--sub)}
select, input{
  width:100%;background:#0d1117;border:1px solid var(--ring);color:var(--text);
  border-radius:12px;height:44px;padding:0 14px;font-size:16px;outline:none
}
select:focus, input:focus{border-color:#3b82f6}

.table{width:100%;border-collapse:collapse;margin-top:10px}
.table th,.table td{border:1px solid var(--ring);padding:10px 12px}
.table th{background:#10151c;color:#cbd5e1}
.table td{background:#0d1117}

.badge{display:inline-block;padding:6px 10px;border-radius:10px;background:#0d1117;border:1px solid var(--ring);color:#cbd5e1;font-size:12px}

.sums{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:16px 0}
.sum{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:16px}
.sum .label{color:var(--sub);font-size:12px}
.sum .value{margin-top:6px;font-size:22px;font-weight:700}

.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:start}
.box{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:16px;min-height:360px}
.box h3{margin:0 0 8px;font-size:16px;color:#cbd5e1}

.desc ul{margin:10px 0 0 20px}
.desc li{margin:6px 0}

.pie-wrap{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:16px;display:flex;align-items:center;justify-content:center;min-height:360px}
.pie-wrap canvas{width:100% !important;height:320px !important}

.legend{display:flex;gap:14px;align-items:center;margin-top:10px;color:#cbd5e1;font-size:12px}
.legend i{display:inline-block;width:12px;height:12px;border-radius:4px;margin-right:6px}
.i-blue{background:var(--blue)} .i-pink{background:var(--pink)} .i-orange{background:var(--orange)}

.cta{margin:24px 0 8px;display:flex;justify-content:flex-start}
.btn{
  background:#10b981;color:#061015;border:none;border-radius:12px;padding:12px 18px;
  font-weight:700;font-size:15px;cursor:pointer;text-decoration:none;display:inline-flex;gap:8px;align-items:center
}
.btn:hover{filter:brightness(1.07)}

@media (max-width:900px){
  .grid{grid-template-columns:1fr}
  .pie-wrap{min-height:300px}
  .pie-wrap canvas{height:260px !important}
  .sums{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div class="wrapper">
  <div class="card">
    <h1>Калькулятор бюджета ремонта</h1>

    <!-- Управляющие поля -->
    <div class="row">
      <div class="field" style="grid-column:span 4">
        <label>Тип жилья</label>
        <select id="typeSel">
          <option value="Новостройка">Новостройка</option>
          <option value="Вторичка">Вторичка</option>
        </select>
      </div>

      <div class="field" style="grid-column:span 4">
        <label>Тариф</label>
        <select id="tierSel">
          <option value="Эконом">Эконом</option>
          <option value="Стандарт">Стандарт</option>
        </select>
      </div>

      <div class="field" style="grid-column:span 4">
        <label>Площадь, м²</label>
        <input id="areaInp" type="number" min="1" step="1" value="50" />
      </div>
    </div>

    <div class="row">
      <div class="field" style="grid-column:span 4">
        <label>Запас, %</label>
        <input id="reserveInp" type="number" min="0" step="1" value="10" />
      </div>

      <div class="field" style="grid-column:span 4">
        <label>Тип ремонта (для вторички)</label>
        <select id="secTypeSel">
          <option value="Косметика">Косметика</option>
          <option value="Полный ремонт">Полный ремонт</option>
        </select>
      </div>

      <div class="field" style="grid-column:span 4;display:flex;align-items:flex-end">
        <span class="badge" id="readyBadge">Готово к расчёту</span>
      </div>
    </div>

    <!-- Таблица -->
    <table class="table" id="tbl">
      <thead>
        <tr>
          <th>Блок</th>
          <th>Материалы ₽/м²</th>
          <th>Работы ₽/м²</th>
          <th>Итого ₽/м²</th>
          <th>Площадь м²</th>
          <th>Материалы ₽</th>
          <th>Работы ₽</th>
          <th>Подытог ₽</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <!-- Суммы -->
    <div class="sums">
      <div class="sum"><div class="label">Итого материалы + мебель</div><div class="value" id="sumMat"></div></div>
      <div class="sum"><div class="label">Итого работы</div><div class="value" id="sumWork"></div></div>
      <div class="sum"><div class="label">Итого с запасом</div><div class="value" id="sumReserve"></div></div>
    </div>

    <div class="grid">
      <div class="box desc">
        <h3>Описание блока</h3>
        <ul id="descList"></ul>
      </div>

      <div class="pie-wrap">
        <canvas id="pie"></canvas>
      </div>
    </div>

    <div class="legend">
      <span><i class="i-blue"></i>Материалы</span>
      <span><i class="i-pink"></i>Работы</span>
      <span><i class="i-orange"></i>Мебель</span>
    </div>

    <div class="cta">
      <a class="btn" href="https://t.me/soloveu" target="_blank" rel="noopener">
        Написать «ХОЧУ PRO»
      </a>
    </div>
  </div>
</div>

<script>
/* ------------------ ДАННЫЕ ------------------ */
const DATA = {
  'Новостройка': {
    'Эконом': {
      blocks: [
        {name:'Черновые', m:15000, w:10000},
        {name:'Чистовые', m: 6000, w:10000},
        {name:'Мебель',    m:25000, w:    0},
      ],
      desc: [
        'Штукатурка, электрика/сантехника по проекту, стяжка с выравниванием. Материалы среднего класса.',
        'Шпаклёвка в 1 слой, обои, ламинат, недорогие натяжные потолки, базовая плитка, двери/фурнитура попроще.',
        'Мебель «средний»: кухня эконом, шкафы, мягкая мебель, техника по списку.'
      ]
    },
    'Стандарт': {
      blocks: [
        {name:'Черновые', m:18000, w:12000},
        {name:'Чистовые', m:10000, w:15000},
        {name:'Мебель',    m:30000, w:    0},
      ],
      desc: [
        'Черновые по проекту, качественная инженерка, ровные базы под чистовые.',
        'Шпаклёвка 2 слоя/краска, кварц-винил/улучшенные покрытия, плитка лучше, двери/фурнитура надёжнее.',
        'Мебель «средний+»: кухня получше, встроенные шкафы, текстиль, техника получше.'
      ]
    }
  },

  'Вторичка': {
    'Эконом': {
      'Косметика': {
        blocks: [
          {name:'Чистовые', m: 6000, w: 6000},
          {name:'Мебель',    m:17000, w:    0},
        ],
        desc: [
          'Расширенная косметика: выравнивание стен/потолка точечно, улучшенные покрытия, качественная фурнитура и свет.',
          'Мебель «средний+»: кухня получше, встроенные шкафы, мягкая мебель, техника по списку.'
        ]
      },
      'Полный ремонт': {
        blocks: [
          {name:'Черновые', m:15000, w:12000},
          {name:'Чистовые', m: 6000, w: 6000},
          {name:'Мебель',    m:25000, w:    0},
        ],
        desc: [
          'Полный демонтаж, черновые по проекту, стяжка с выравниванием. Материалы среднего класса.',
          'Шпаклёвка 2 слоя, окраска, кварц-винил/лучшая плитка, двери/фурнитура надёжнее.',
          'Мебель «средний+»: кухня получше, встроенные шкафы, текстиль, техника по списку.'
        ]
      }
    },
    'Стандарт': {
      'Косметика': {
        blocks: [
          {name:'Чистовые', m:12000, w:12000},
          {name:'Мебель',    m:30000, w:    0},
        ],
        desc: [
          'Косметика уровня «стандарт»: выравнивания больше, материалы выше классом.',
          'Мебель «средний+»: кухня получше, встроенные шкафы, текстиль, техника по списку.'
        ]
      },
      'Полный ремонт': {
        blocks: [
          {name:'Черновые', m:18000, w:15000},
          {name:'Чистовые', m:12000, w:12000},
          {name:'Мебель',    m:30000, w:    0},
        ],
        desc: [
          'Полный демонтаж, новые инженерные сети, черновые под чистовую идею.',
          'Чистовые выше классом: краска, плитка, напольные покрытия, двери/фурнитура.',
          'Мебель «средний+»: кухня получше, встроенные шкафы, текстиль, техника по списку.'
        ]
      }
    }
  }
};

/* ------------- ЭЛЕМЕНТЫ ------------- */
const typeSel    = document.getElementById('typeSel');
const tierSel    = document.getElementById('tierSel');
const secTypeSel = document.getElementById('secTypeSel');
const areaInp    = document.getElementById('areaInp');
const reserveInp = document.getElementById('reserveInp');
const tbody      = document.getElementById('tbody');
const sumMat     = document.getElementById('sumMat');
const sumWork    = document.getElementById('sumWork');
const sumRes     = document.getElementById('sumReserve');
const descList   = document.getElementById('descList');

/* ------------- УТИЛИТЫ ------------- */
const F = n => (n||0).toLocaleString('ru-RU') + ' ₽';
const clampArea = () => {
  let v = parseInt(areaInp.value||0,10);
  if (isNaN(v)||v<1) v=1;
  if (v>10000) v=10000;
  areaInp.value = v;
};

/* ------------- РЕНДЕР ------------- */
function recalc(){
  clampArea();
  const type = typeSel.value;
  const tier = tierSel.value;
  const secT = secTypeSel.value;
  const area = parseInt(areaInp.value||0,10);
  const reserve = Math.max(0, parseInt(reserveInp.value||0,10));

  // для новостройки игнорируем селектор вторички
  const conf = (type === 'Вторичка')
    ? DATA[type][tier][secT]
    : DATA[type][tier];

  // таблица
  tbody.innerHTML = '';
  let totalMat = 0, totalWork = 0, totalAll = 0, furnSum = 0;

  conf.blocks.forEach(b=>{
    const per = (b.m + b.w);
    const mSum = b.m * area;
    const wSum = b.w * area;
    const rowSum = mSum + wSum;

    if (b.name === 'Мебель') furnSum += mSum;

    totalMat  += mSum;
    totalWork += wSum;
    totalAll  += rowSum;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${b.name}</td>
      <td>${(b.m).toLocaleString('ru-RU')} ₽/м²</td>
      <td>${(b.w).toLocaleString('ru-RU')} ₽/м²</td>
      <td>${(per).toLocaleString('ru-RU')} ₽/м²</td>
      <td>${area}</td>
      <td>${F(mSum)}</td>
      <td>${F(wSum)}</td>
      <td>${F(rowSum)}</td>
    `;
    tbody.appendChild(tr);
  });

  sumMat.textContent  = F(totalMat);
  sumWork.textContent = F(totalWork);
  const withReserve = Math.round(totalAll * (1 + reserve/100));
  sumRes.textContent = F(withReserve);

  // описание
  descList.innerHTML = '';
  conf.desc.forEach(t=>{
    const li = document.createElement('li');
    li.textContent = t;
    descList.appendChild(li);
  });

  // диаграмма (материалы/работы/мебель)
  renderPie(totalMat - furnSum, totalWork, furnSum);
}

/* ------------- ПОНЧИК ------------- */
let pie;
function renderPie(mat, work, furn){
  const ctx = document.getElementById('pie');
  const data = [mat, work, furn];
  const labels = ['Материалы', 'Работы', 'Мебель'];

  if (pie) pie.destroy();

  pie = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: ['var(--blue)','var(--pink)','var(--orange)'],
        borderColor: '#1e1e1e', borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false, // высоту берём из CSS
      plugins: {
        legend: { display: true, position: 'bottom',
          labels: { color:'#cbd5e1', usePointStyle:true, boxWidth:10 } },
        tooltip: {
          callbacks: {
            label: (ctx)=>{
              const total = ctx.dataset.data.reduce((a,b)=>a+b,0);
              const v = ctx.raw||0;
              const pct = total? Math.round(v/total*100) : 0;
              return `${ctx.label}: ${v.toLocaleString('ru-RU')} ₽ (${pct}%)`;
            }
          }
        },
        datalabels: {
          color:'#e2e8f0', font:{weight:700},
          formatter:(value,ctx)=>{
            const total = ctx.dataset.data.reduce((a,b)=>a+b,0);
            if (!total) return '';
            const pct = Math.round(value/total*100);
            return pct? pct+'%' : '';
          }
        }
      },
      cutout: '55%'
    },
    plugins: [ChartDataLabels]
  });
}

/* ------------- СОБЫТИЯ ------------- */
[typeSel, tierSel, secTypeSel, areaInp, reserveInp].forEach(el=>{
  el.addEventListener('input', recalc);
});

/* старт */
recalc();
</script>
</body>
</html>
